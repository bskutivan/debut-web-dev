{% assign featured = section.settings.featured_products %}
{% assign products_per_row = 4 %}

<div class="featured-products shopify-section page-width">

{%- comment -%}
  Title generated by default in settings but also customizable according to user in theme settings
{%- endcomment -%}

    {% if section.settings.title != blank %}
        <div class="section-header">
            <h2> {{section.settings.title | escape}} </h2>    
        </div>
        
    {% endif %}

    <div class="grid grid__custom-two-columns" role="list">

        {% for product in collections[featured].products %}

            {% assign img_url = product.featured_image %}

            <div class="grid__item grid__item__custom product" role="listitem">

                <a href="{{product.url}}" class="product__image-wrapper" title="{{ product.title | escape}}">
                    {% for image in product.images %}
                        <img class="product__image product__image__custom" src="{{ image.src | product_img_url: 'medium' }}">
                    {% endfor %}
                </a>

                <div class="product__title">
                    <a href="{{product.url}}">{{product.title | escape}}</a>
                </div>

                <div class="product__prices">

                    {%- comment -%}
                        should a need for varied prices (sale prices or variant prices etc) this is where they would go. To fit the brief as cleanly as 
                        possible I have only included elemts to display the single product price each product has
                    {%- endcomment -%}

                    <span class="product__price">
                        <strong>{{product.price | money}}</strong>
                    </span>
                </div>

                {% if product.available == true %}                    
                    <div class="product__btn">
                        <button class="btn btn__custom" id="js-btn-custom"type="button" data-productId="{{product.id}}">
                            Add To Cart
                        </button>
                    </div>
                {% endif %}

            </div>
        {% endfor %}
    </div>
</div>

<script>
    window.onload = () => {
       const buyBtn = document.querySelectorAll("#js-btn-custom");

        for (var i = 0; i < buyBtn.length; i++) {

            let productId = buyBtn[i].getAttribute('data-productId');

            buyBtn[i].addEventListener("click", function(productId) {
                addToCart(productId);
            });
        }
    }

    const addToCart = (productId) => {
        console.log(productId);
    }

</script>


{% schema %}
{
    "name": "Featured Products",
    "settings": [
    {
        "type":"text",
        "id": "title",
        "label": "Heading",
        "default": "Featured Products"
    },
    {
        "type": "collection",
        "id": "featured_products",
        "label": "Collection"
    }],
    "presets": [
        {
            "name":"Featured Products",
            "category": "Collection"
        }
    ],
    "blocks": []
}
{% endschema %}